(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["planetdetail"],{1988:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"new-card"},["new"===t.type?i("div",{staticClass:"header-title"},["/planetdetail"!==t.$route.path?i("div",{staticClass:"left",on:{click:function(e){return t.$router.push("/planetdetail?id="+t.content.planet.id)}}},[i("img",{staticClass:"icon",attrs:{src:n("65f2"),alt:""}}),i("span",[t._v("来自")]),i("span",{staticClass:"planet"},[t._v(t._s(t.content.planet.name))])]):t._e(),i("div",{class:["right",{joined:t.joined}],on:{click:function(e){return e.stopPropagation(),t.addPlanet(t.content)}}},[t.joined?i("button",{staticClass:"enter"},[t._v(t._s("进入"))]):i("button",{staticClass:"add"},[t._v(t._s("+ 加入"))])])]):t._e(),i("div",[i("div",{staticClass:"user-info",on:{click:function(e){return t.goUrl("/postdetail?id="+t.content.id)}}},["user"===t.content.source?i("img",{staticClass:"avatar",attrs:{src:t.content.user.avatar,alt:"头像"}}):t._e(),"user"===t.content.source?i("span",{staticClass:"name"},[t._v(t._s(t.content.planet.name))]):t._e(),i("span",{staticClass:"time"},[t._v(t._s(t.content.created_at))])]),i("div",{staticClass:"content"},["微博"!==t.content.source?i("div",{staticClass:"title",on:{click:function(e){return t.goUrl("/postdetail?id="+t.content.id)}}},[t._v(t._s(t.content.title))]):t._e(),t.content.thumb_video?t._e():i("div",{staticClass:"desc"},[t.content.desc_content?i("div",{staticClass:"info",domProps:{innerHTML:t._s(t.content.desc_content)}}):i("div",{staticClass:"info",domProps:{innerHTML:t._s(t.content.content)}})]),i("div",{staticClass:"photo-box"},[t.content.thumb_pic?i("div",{staticClass:"photo"},[i("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.content.thumb_pic,"preview-src-list":t.srcList}})],1):t._e()]),t.content.thumb_video?i("div",{staticClass:"video-box"},[i("video",{ref:"video",class:{hidden:t.showPreview},attrs:{src:t.content.thumb_video,controls:"controls",preload:"metadata",controlslist:"nodownload","x5-playsinline":"",playsinline:"true","webkit-playsinline":"true","x-webkit-airplay":"true","x5-video-player-type":"h5","x5-video-player-fullscreen":"","x5-video-orientation":"portraint"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showPreview,expression:"showPreview"}],ref:"previewImg",staticClass:"previwe-img",on:{click:function(e){return e.stopPropagation(),t.playVideo(e)}}},[i("img",{attrs:{src:t.videoPreviwe}}),t.videoPlayed?i("div",{staticClass:"video-replay"}):i("div",{staticClass:"video-ready"})])]):t._e(),i("div",{staticClass:"tag-box"},t._l(t.content.tags,(function(e,n){return i("div",{key:n,staticClass:"tag"},[i("span",[t._v("#"+t._s(e.name))])])})),0)])]),i("TalkApprovalShare",{attrs:{content:t.content},on:{"update:content":function(e){t.content=e}}})],1)},s=[],a=(n("96cf"),n("1da1")),o=n("f489"),c=n("ca00"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tool"},[n("div",{staticClass:"tool-bar"},[n("div",{staticClass:"talk",on:{click:t.bindTalk}},[n("i",{staticClass:"iconfont iconpinglun"}),n("span",[t._v(t._s(0===t.content.comments_count?"回复":t.content.comments_count))])]),n("div",{staticClass:"approval",on:{click:t.bindApproval}},[n("i",{staticClass:"iconfont iconzan",class:{active:t.hasLiked}}),n("span",[t._v(t._s(t.userLikedCount))])])])])},d=[],l=(n("6762"),n("9c3c")),u={props:{content:{type:Object,default:function(){}},type:{type:String,default:"post"},showShare:{type:Boolean,default:!0}},components:{},data:function(){return{hasLiked:!1,userLikedCount:0}},watch:{content:{handler:function(t){this.hasLiked=t.has_liked,this.userLikedCount=t.user_liked_count},immediate:!0}},methods:{bindTalk:function(){this.$route.path.includes("postdetail")?this.$refs.inputItem.showInput=!0:this.$router.push("/postdetail?id=".concat(this.content.id))},bindApproval:function(){var t=this;c["a"].getcookie("TOKEN")||this.$store.dispatch("needAuth"),"post"===this.type?this.hasLiked?Object(l["i"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.userLikedCount--,t.$message("取消点赞文章成功！"))})):Object(l["h"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.$message("点赞文章成功！"),t.userLikedCount++)})):this.hasLiked?Object(l["d"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.userLikedCount--,t.$message("取消评论点赞成功！"))})):Object(l["c"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.$message("点赞评论成功！"),t.userLikedCount++)}))}}},h=u,p=(n("f94d"),n("2877")),v=Object(p["a"])(h,r,d,!1,null,"406bf8bf",null),f=v.exports,m={name:"NewCard",components:{TalkApprovalShare:f},props:{type:{type:String,default:""},content:{type:Object,default:function(){}}},data:function(){return{joined:!1,showPreview:!0,videoPlayed:!1,videoPreviwe:"",srcList:[]}},watch:{"content.thumb_pic":{handler:function(t){t&&this.srcList.push(t)},immediate:!0},"content.thumb_video":{handler:function(t){t&&this.$nextTick(this.getVideoposter)},immediate:!0},"$state.userPlanet":{handler:function(t){var e=this;t.some((function(t){return t.id===e.content.planet_id}))&&(this.joined=!0)},immediate:!0,deep:!0}},methods:{goUrl:function(t){this.$router.push(t)},bindTalk:function(){this.$refs.inputItem.showInput=!0},addPlanet:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:c["a"].getcookie("TOKEN")||this.$store.dispatch("needAuth"),this.joined?this.goUrl("/planetdetail?id=".concat(e.planet_id)):this.$confirm("是否加入该星球","提示").then((function(){Object(o["e"])(e.planet_id).then((function(t){200===t.code&&n.goUrl("/planetdetail?id=".concat(e.planet_id))}))})).catch((function(){}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getVideoposter:function(){var t=this,e=this.$refs.video;e.setAttribute("crossOrigin","Anonymous"),e.currentTime=.001,e.onloadeddata=function(n){t.videoPreviwe=c["a"].getVideoPre(e)},e.onended=function(n){t.videoPreviwe=c["a"].getVideoPre(e),t.videoPlayed=!0,t.showPreview=!0}},playVideo:function(){this.showPreview=!1,this.$refs.video.play()}}},g=m,_=(n("6833"),Object(p["a"])(g,i,s,!1,null,"39ad0b29",null));e["a"]=_.exports},"47be":function(t,e,n){},"55f3":function(t,e,n){},6833:function(t,e,n){"use strict";var i=n("e4e7"),s=n.n(i);s.a},a1be:function(t,e,n){"use strict";var i=n("55f3"),s=n.n(i);s.a},a98d:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"planet"},[n("div",{staticClass:"layout"},[n("Header",{on:{getSerch:t.getSerch}}),n("div",{staticClass:"layout-main"},[n("div",{staticClass:"community-container"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.content.id,expression:"content.id"}],staticClass:"planet-box",style:"background: url("+t.content.background+") no-repeat center; background-size: 750px 350px;"},[n("div",{staticClass:"top"},[n("div",{staticClass:"name"},[t._v(t._s(t.content.name))]),n("div",{class:["btn",{joined:!t.content.joined}],on:{click:function(e){return t.addPlanet(t.content)}}},[t._v(t._s(t.content.joined?"已加入":"加入"))])]),n("div",{staticClass:"buttom"},[n("div",{staticClass:"desc"},[t._v(t._s(t.content.intro))])])]),n("div",{staticClass:"community-main"},[n("div",{staticClass:"card-list"},[n("div",{staticClass:"infinite-scroll",staticStyle:{"overflow-y":"auto"}},[n("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.onLoad,expression:"onLoad"}],staticClass:"infinite-list",attrs:{"infinite-scroll-disabled":t.disabled,"infinite-scroll-distance":10}},t._l(t.cardList,(function(e,i){return n("li",{key:i},[n("NewCard",{attrs:{type:t.type,content:e},on:{"update:type":function(e){t.type=e}}})],1)})),0),n("p",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]},[t._v("加载中...")]),n("p",{directives:[{name:"show",rawName:"v-show",value:t.finished,expression:"finished"}],attrs:{id:"footer"}},[t._v(t._s(t.page===t.last_page?"没有更多了":""))])])])])])])],1)])},s=[],a=(n("96cf"),n("1da1")),o=(n("ac6a"),n("1988")),c=n("f489"),r=n("ca00"),d={name:"index",data:function(){return{ajax:!1,id:this.$route.query.id||"",content:{},type:"new",page:1,per_page:10,last_page:0,cardList:[],keyWord:"",loading:!1,finished:!1}},mounted:function(){var t=this;this.getData(),this.getList(),setTimeout((function(){t.listenerAction()}),20)},methods:{onLoad:function(t){var e=this;t&&(this.cardList=[]),this.loading=!0,setTimeout((function(){e.getList()}),300)},getSerch:function(t){this.page=1,this.cardList=[],this.keyWord=t,this.getList()},getData:function(t){var e=this;Object(c["b"])(this.id).then((function(t){if(200===t.code){var n=e.$state.userPlanet.some((function(e){return e.id===t.data.id}));t.data.joined=n,e.content=t.data}}))},getList:function(){var t=this;Object(c["d"])({id:this.id,page:this.page,per_page:this.per_page}).then((function(e){200===e.code&&e.data?(t.last_page=e.last_page,e.data.forEach((function(t){t.user.avatar=r["a"].defaultAvatar(t.user.avatar),t.thumb_pic||(t.thumb_pic=r["a"].getFirstImg(t.content)),t.content=r["a"].changeHtml2Crad(t.content)})),t.cardList=t.cardList.concat(e.data),e.last_page===e.current_page?t.finished=!0:(t.loading=!1,t.page++)):t.finished=!0,t.ajax=!1})).catch((function(){t.ajax=!1}))},getClear:function(){this.page=1,this.cardList=[],this.getList(this.type)},addPlanet:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r["a"].getcookie("TOKEN")||this.$store.dispatch("needAuth"),!this.content.joined){t.next=3;break}return t.abrupt("return");case 3:this.$confirm("是否加入该星球","提示").then((function(){Object(c["e"])(n.id).then((function(t){n.$store.dispatch("getUserPlanetList"),n.$message.success("加入星球成功！"),location.reload()}))})).catch((function(){}));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),listenerAction:function(){window.addEventListener("scroll",this.scrollhandle),document.documentElement.scrollTop=0},scrollhandle:function(t){if(this.page!==this.last_page){var e=document.getElementById("footer").offsetTop,n=document.documentElement.scrollTop;e>=n&&e<n+window.innerHeight&&!this.loading&&(this.finished=!1,this.getData(this.type))}}},computed:{disabled:function(){return this.loading=!1,this.finished}},beforeDestroy:function(){window.removeEventListener("scroll",this.scrollhandle,!1)},components:{NewCard:o["a"]}},l=d,u=(n("a1be"),n("2877")),h=Object(u["a"])(l,i,s,!1,null,"0877f4a6",null);e["default"]=h.exports},e4e7:function(t,e,n){},f94d:function(t,e,n){"use strict";var i=n("47be"),s=n.n(i);s.a}}]);