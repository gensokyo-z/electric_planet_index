(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["index"],{1988:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"new-card"},["new"===t.type?n("div",{staticClass:"header-title"},["/planetdetail"!==t.$route.path?n("div",{staticClass:"left",on:{click:function(e){return t.$router.push("/planetdetail?id="+t.content.planet.id)}}},[n("img",{staticClass:"icon",attrs:{src:i("65f2"),alt:""}}),n("span",[t._v("来自")]),n("span",{staticClass:"planet"},[t._v(t._s(t.content.planet.name))])]):t._e(),n("div",{class:["right",{joined:t.joined}],on:{click:function(e){return e.stopPropagation(),t.addPlanet(t.content)}}},[t.joined?n("button",{staticClass:"enter"},[t._v(t._s("进入"))]):n("button",{staticClass:"add"},[t._v(t._s("+ 加入"))])])]):t._e(),n("div",[n("div",{staticClass:"user-info",on:{click:function(e){return t.goUrl("/postdetail?id="+t.content.id)}}},["user"===t.content.source?n("img",{staticClass:"avatar",attrs:{src:t.content.user.avatar,alt:"头像"}}):t._e(),"user"===t.content.source?n("span",{staticClass:"name"},[t._v(t._s(t.content.planet.name))]):t._e(),n("span",{staticClass:"time"},[t._v(t._s(t.content.created_at))])]),n("div",{staticClass:"content"},["微博"!==t.content.source?n("div",{staticClass:"title",on:{click:function(e){return t.goUrl("/postdetail?id="+t.content.id)}}},[t._v(t._s(t.content.title))]):t._e(),t.content.thumb_video?t._e():n("div",{staticClass:"desc"},[t.content.desc_content?n("div",{staticClass:"info",domProps:{innerHTML:t._s(t.content.desc_content)}}):n("div",{staticClass:"info",domProps:{innerHTML:t._s(t.content.content)}})]),n("div",{staticClass:"photo-box"},[t.content.thumb_pic?n("div",{staticClass:"photo"},[n("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.content.thumb_pic,"preview-src-list":t.srcList}})],1):t._e()]),t.content.thumb_video?n("div",{staticClass:"video-box"},[n("video",{ref:"video",class:{hidden:t.showPreview},attrs:{src:t.content.thumb_video,controls:"controls",preload:"metadata",controlslist:"nodownload","x5-playsinline":"",playsinline:"true","webkit-playsinline":"true","x-webkit-airplay":"true","x5-video-player-type":"h5","x5-video-player-fullscreen":"","x5-video-orientation":"portraint"}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showPreview,expression:"showPreview"}],ref:"previewImg",staticClass:"previwe-img",on:{click:function(e){return e.stopPropagation(),t.playVideo(e)}}},[n("img",{attrs:{src:t.videoPreviwe}}),t.videoPlayed?n("div",{staticClass:"video-replay"}):n("div",{staticClass:"video-ready"})])]):t._e(),n("div",{staticClass:"tag-box"},t._l(t.content.tags,(function(e,i){return n("div",{key:i,staticClass:"tag"},[n("span",[t._v("#"+t._s(e.name))])])})),0)])]),n("TalkApprovalShare",{attrs:{content:t.content},on:{"update:content":function(e){t.content=e}}})],1)},a=[],s=(i("96cf"),i("1da1")),o=i("f489"),c=i("ca00"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tool"},[i("div",{staticClass:"tool-bar"},[i("div",{staticClass:"talk",on:{click:t.bindTalk}},[i("i",{staticClass:"iconfont iconpinglun"}),i("span",[t._v(t._s(0===t.content.comments_count?"回复":t.content.comments_count))])]),i("div",{staticClass:"approval",on:{click:t.bindApproval}},[i("i",{staticClass:"iconfont iconzan",class:{active:t.hasLiked}}),i("span",[t._v(t._s(t.userLikedCount))])])])])},d=[],l=(i("6762"),i("9c3c")),u={props:{content:{type:Object,default:function(){}},type:{type:String,default:"post"},showShare:{type:Boolean,default:!0}},components:{},data:function(){return{hasLiked:!1,userLikedCount:0}},watch:{content:{handler:function(t){this.hasLiked=t.has_liked,this.userLikedCount=t.user_liked_count},immediate:!0}},methods:{bindTalk:function(){this.$route.path.includes("postdetail")?this.$refs.inputItem.showInput=!0:this.$router.push("/postdetail?id=".concat(this.content.id))},bindApproval:function(){var t=this;c["a"].getcookie("TOKEN")||this.$store.dispatch("needAuth"),"post"===this.type?this.hasLiked?Object(l["i"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.userLikedCount--,t.$message("取消点赞文章成功！"))})):Object(l["h"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.$message("点赞文章成功！"),t.userLikedCount++)})):this.hasLiked?Object(l["d"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.userLikedCount--,t.$message("取消评论点赞成功！"))})):Object(l["c"])(this.content.id).then((function(e){200===e.code&&(t.hasLiked=!t.hasLiked,t.$message("点赞评论成功！"),t.userLikedCount++)}))}}},h=u,p=(i("f94d"),i("2877")),f=Object(p["a"])(h,r,d,!1,null,"406bf8bf",null),v=f.exports,m={name:"NewCard",components:{TalkApprovalShare:v},props:{type:{type:String,default:""},content:{type:Object,default:function(){}}},data:function(){return{joined:!1,showPreview:!0,videoPlayed:!1,videoPreviwe:"",srcList:[]}},watch:{"content.thumb_pic":{handler:function(t){t&&this.srcList.push(t)},immediate:!0},"content.thumb_video":{handler:function(t){t&&this.$nextTick(this.getVideoposter)},immediate:!0},"$state.userPlanet":{handler:function(t){var e=this;t.some((function(t){return t.id===e.content.planet_id}))&&(this.joined=!0)},immediate:!0,deep:!0}},methods:{goUrl:function(t){this.$router.push(t)},bindTalk:function(){this.$refs.inputItem.showInput=!0},addPlanet:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:c["a"].getcookie("TOKEN")||this.$store.dispatch("needAuth"),this.joined?this.goUrl("/planetdetail?id=".concat(e.planet_id)):this.$confirm("是否加入该星球","提示").then((function(){Object(o["e"])(e.planet_id).then((function(t){200===t.code&&i.goUrl("/planetdetail?id=".concat(e.planet_id))}))})).catch((function(){}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getVideoposter:function(){var t=this,e=this.$refs.video;e.setAttribute("crossOrigin","Anonymous"),e.currentTime=.001,e.onloadeddata=function(i){t.videoPreviwe=c["a"].getVideoPre(e)},e.onended=function(i){t.videoPreviwe=c["a"].getVideoPre(e),t.videoPlayed=!0,t.showPreview=!0}},playVideo:function(){this.showPreview=!1,this.$refs.video.play()}}},g=m,_=(i("6833"),Object(p["a"])(g,n,a,!1,null,"39ad0b29",null));e["a"]=_.exports},"37f9":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"index"},[i("div",{staticClass:"layout"},[i("Header",{on:{getSerch:t.getSerch}}),i("div",{staticClass:"layout-main"},[i("div",{staticClass:"community-container"},[i("div",{staticClass:"community-main"},[i("div",{staticClass:"card-list"},[i("TabBar",{on:{bindTab:t.bindTab}}),i("div",{staticClass:"infinite-scroll",staticStyle:{"overflow-y":"auto"}},[i("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.onLoad,expression:"onLoad"}],staticClass:"infinite-list",attrs:{"infinite-scroll-disabled":t.disabled,"infinite-scroll-distance":10}},t._l(t.cardList,(function(e,n){return i("li",{key:n},[i("NewCard",{attrs:{type:t.type,content:e},on:{"update:type":function(e){t.type=e}}})],1)})),0),i("p",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]},[t._v("加载中...")]),i("p",{directives:[{name:"show",rawName:"v-show",value:t.finished,expression:"finished"}],attrs:{id:"footer"}},[t._v(t._s(t.page===t.last_page?"没有更多了":""))])])],1)]),i("div",{staticClass:"community-aside"})])])],1)])},a=[],s=(i("ac6a"),i("1988")),o=i("b775");function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["a"])({url:"/api/feed/index/newest",method:"get",params:t})}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["a"])({url:"/api/feed/index/hotest",method:"get",params:t})}var d=i("ca00"),l={name:"index",data:function(){return{ajax:!1,type:"new",page:1,per_page:10,last_page:0,cardList:[],keyWord:"",loading:!1,finished:!1}},mounted:function(){var t=this;setTimeout((function(){t.listenerAction()}),20)},methods:{onLoad:function(t){var e=this;t&&(this.cardList=[]),this.loading=!0,setTimeout((function(){e.getData(e.type)}),300)},getSerch:function(t){this.page=1,this.cardList=[],this.keyWord=t,this.getData(this.type)},getData:function(t){var e=this;this.ajax||(this.ajax=!0,this.finished=!0,"new"===t?c({page:this.page,per_page:this.per_page,keyword:this.keyWord}).then((function(t){200===t.code&&t.data?(e.last_page=t.last_page,t.data.forEach((function(t){t.user.avatar=d["a"].defaultAvatar(t.user.avatar),t.thumb_pic||(t.thumb_pic=d["a"].getFirstImg(t.content)),t.content=d["a"].changeHtml2Crad(t.content)})),e.cardList=e.cardList.concat(t.data),t.last_page===t.current_page?e.finished=!0:(e.loading=!1,e.page++)):e.finished=!0,e.ajax=!1})).catch((function(){e.ajax=!1})):r({page:this.page,per_page:this.per_page,keyword:this.keyWord}).then((function(t){200===t.code&&t.data?(e.last_page=t.last_page,t.data.forEach((function(t){t.user.avatar=d["a"].defaultAvatar(t.user.avatar),t.thumb_pic||(t.thumb_pic=d["a"].getFirstImg(t.content)),t.content=d["a"].changeHtml2Crad(t.content)})),e.cardList=e.cardList.concat(t.data),t.last_page===t.current_page?e.finished=!0:(e.loading=!1,e.page++)):e.finished=!0,e.ajax=!1})).catch((function(){e.ajax=!1})))},getClear:function(){this.page=1,this.cardList=[],this.getData(this.type)},bindTab:function(t){this.finished=!1,this.type=t,this.getClear()},gotoDetail:function(t){this.$router.push("/postdetail?id=".concat(t.id))},listenerAction:function(){window.addEventListener("scroll",this.scrollhandle),document.documentElement.scrollTop=0},scrollhandle:function(t){if(this.page!==this.last_page){var e=document.getElementById("footer").offsetTop,i=document.documentElement.scrollTop;e>=i&&e<i+window.innerHeight&&!this.loading&&(this.finished=!1,this.getData(this.type))}}},computed:{disabled:function(){return this.loading=!1,this.finished}},beforeDestroy:function(){window.removeEventListener("scroll",this.scrollhandle,!1)},components:{TabBar:function(){return i.e("chunk-3ad77c66").then(i.bind(null,"af06"))},NewCard:s["a"]}},u=l,h=(i("d19d"),i("2877")),p=Object(h["a"])(u,n,a,!1,null,"1f0b738a",null);e["default"]=p.exports},"47be":function(t,e,i){},"512b":function(t,e,i){},6833:function(t,e,i){"use strict";var n=i("e4e7"),a=i.n(n);a.a},d19d:function(t,e,i){"use strict";var n=i("512b"),a=i.n(n);a.a},e4e7:function(t,e,i){},f94d:function(t,e,i){"use strict";var n=i("47be"),a=i.n(n);a.a}}]);